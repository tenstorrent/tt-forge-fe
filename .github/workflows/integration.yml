# This workflow runs a schedule and uses the latest version of tt-mlir (origin/main branch)
# to check if the latest version of tt-mlir is compatible with the current codebase.

name: Integration

on:
  workflow_dispatch:
  schedule:
    - cron: '0 0 * * *'
  push:

jobs:
  docker-build:
    uses: ./.github/workflows/docker-build.yml
    secrets: inherit
    with: 
      tt-mlir-version: 'origin/main'

  notify-failure:
    needs: docker-build
    if: ${{ always() && needs.docker-build.result == 'failure' }}
    runs-on: ubuntu-latest
    env:
      GH_TOKEN: ${{ github.token }}
    steps:
      - name: Create Issue
        run: |
            gh issue create \
            --title "Integration run failed - $(date +'%Y-%m-%d')" \
            --body "The Docker build job failed in the Integration workflow.\nWorkflow: ${{ github.workflow }}\nWorkflow Run: ${{ github.run_id }}\nWorkflow Run URL: ${{ github.run_url }}" \
            --assignee ${{ vars.INTEGRATION_OWNER }}
            
