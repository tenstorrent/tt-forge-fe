# SPDX-FileCopyrightText: (c) 2025 Tenstorrent AI ULC
#
# SPDX-License-Identifier: Apache-2.0
#
# Register of all detected failing reasons by operator

from test.operators.utils import FailingReasons


class FailingReasonsRegister:

    # List of failing reasons for each operator
    # Format: (operator, failing_reason)
    xfail = [
        ("add", FailingReasons.DATA_MISMATCH_ALL_CLOSE),
        ("add", FailingReasons.DATA_MISMATCH_PCC_LOW_RANGE),
        ("avg_pool_2d", FailingReasons.DATA_MISMATCH_PCC_LOW_RANGE),
        ("avg_pool_2d", FailingReasons.INCORRECT_TENSOR_SHAPE),
        ("avg_pool_2d", FailingReasons.OUT_OF_MEMORY),
        ("avg_pool_2d", FailingReasons.PAD_BIGGER_THAN_HALF_OF_KERNEL),
        ("batch_norm_1d", FailingReasons.AXIS_OUT_OF_BOUNDS),
        ("batch_norm_3d", FailingReasons.SOURCE_MAPS_NOT_POPULATED),
        ("clamp", FailingReasons.FAILED_MLIR_VERIFICATION),
        ("clamp", FailingReasons.VALUE_CONVERSION_OVERFLOW),
        ("concatenate", FailingReasons.CIRCULAR_BUFFER_EXCEEDS_L1),
        ("conv2d", FailingReasons.CIRCULAR_BUFFER_CLASH),
        ("conv2d", FailingReasons.CIRCULAR_BUFFER_EXCEEDS_L1),
        ("conv2d", FailingReasons.CIRCULAR_MODE_NOT_SUPPORTED),
        ("conv2d", FailingReasons.CONV2D_VALIDATE_ARGS),
        ("conv2d", FailingReasons.DATA_MISMATCH_PCC_HIGH_RANGE),
        ("conv2d", FailingReasons.DATA_MISMATCH_PCC_LOW_RANGE),
        ("conv2d", FailingReasons.NOT_IMPLEMENTED_ATEN),
        ("conv2d", FailingReasons.OUT_OF_MEMORY),
        ("conv_transpose_2d", FailingReasons.ASSERT_DIM),
        ("conv_transpose_2d", FailingReasons.ASSERT_GROUPS),
        ("conv_transpose_2d", FailingReasons.ASSERT_STRIDE),
        ("conv_transpose_2d", FailingReasons.CIRCULAR_BUFFER_CLASH),
        ("conv_transpose_2d", FailingReasons.DATA_MISMATCH_PCC_LOW_RANGE),
        ("conv_transpose_2d", FailingReasons.INVALID_ARGUMENTS_TO_RESHAPE),
        ("conv_transpose_2d", FailingReasons.OUT_OF_MEMORY),
        ("conv_transpose_2d", FailingReasons.VERIFICATION_FAILED_PCC_NAN),
        ("cos", FailingReasons.DATA_MISMATCH_AUTOMATIC),
        ("cumsum", FailingReasons.DATA_MISMATCH_ALL_CLOSE),
        ("div", FailingReasons.DATA_MISMATCH_ALL_CLOSE),
        ("div", FailingReasons.DATA_MISMATCH_PCC_LOW_RANGE),
        ("div", FailingReasons.DTYPE_MISMATCH),
        ("div", FailingReasons.VERIFICATION_FAILED_SPECIAL_VALUES),
        ("embedding", FailingReasons.FAILED_MLIR_VERIFICATION),
        ("embedding", FailingReasons.OUT_OF_MEMORY),
        ("exp", FailingReasons.DATA_MISMATCH_ALL_CLOSE),
        ("ge", FailingReasons.DATA_MISMATCH_PCC_LOW_RANGE),
        ("ge", FailingReasons.DTYPE_MISMATCH),
        ("gt", FailingReasons.DATA_MISMATCH_PCC_LOW_RANGE),
        ("gt", FailingReasons.DTYPE_MISMATCH),
        ("isnan", FailingReasons.DTYPE_MISMATCH),
        ("layer_norm", FailingReasons.DATA_MISMATCH_ALL_CLOSE),
        ("layer_norm", FailingReasons.NORMALIZATION_ONLY_LAST_DIM),
        ("layer_norm", FailingReasons.UNHANDLED_CASE_NONE),
        ("layer_norm", FailingReasons.VERIFICATION_FAILED_PCC_NAN),
        ("linear", FailingReasons.DATA_MISMATCH_ALL_CLOSE),
        ("linear", FailingReasons.OUT_OF_MEMORY),
        ("log", FailingReasons.DATA_MISMATCH_AUTOMATIC),
        ("log", FailingReasons.VERIFICATION_FAILED_SPECIAL_VALUES),
        ("log1p", FailingReasons.DATA_MISMATCH_ALL_CLOSE),
        ("log1p", FailingReasons.DTYPE_MISMATCH),
        ("log1p", FailingReasons.VERIFICATION_FAILED_SPECIAL_VALUES),
        ("lt", FailingReasons.DATA_MISMATCH_PCC_LOW_RANGE),
        ("lt", FailingReasons.DTYPE_MISMATCH),
        ("matmul", FailingReasons.DATA_MISMATCH_AUTOMATIC),
        ("matmul", FailingReasons.RELAY_OP_SHAPE_CHECK),
        ("matmul", FailingReasons.UNSUPPORTED_DATA_FORMAT),
        ("matmul", FailingReasons.UNSUPPORTED_INPUT_SHAPE_MATMUL),
        ("maximum", FailingReasons.DATA_MISMATCH_PCC_LOW_RANGE),
        ("max_pool_2d", FailingReasons.ASYMMETRIC_DILATION_NOT_SUPPORTED),
        ("max_pool_2d", FailingReasons.ASYMMETRIC_KERNEL_NOT_SUPPORTED),
        ("max_pool_2d", FailingReasons.ASYMMETRIC_STRIDE_NOT_SUPPORTED),
        ("max_pool_2d", FailingReasons.AUTOSHARDING_ERROR),
        ("max_pool_2d", FailingReasons.CIRCULAR_BUFFER_CLASH),
        ("max_pool_2d", FailingReasons.CORE_CHANNELS_MODULUS_NOT_ZERO),
        ("max_pool_2d", FailingReasons.DATA_MISMATCH_PCC_HIGH_RANGE),
        ("max_pool_2d", FailingReasons.OUT_OF_MEMORY),
        ("max_pool_2d", FailingReasons.UNSUPPORTED_DILATION),
        ("mean", FailingReasons.FAILED_MLIR_VERIFICATION),
        ("minimum", FailingReasons.DATA_MISMATCH_PCC_LOW_RANGE),
        ("mul", FailingReasons.DATA_MISMATCH_PCC_LOW_RANGE),
        ("ne", FailingReasons.DTYPE_MISMATCH),
        ("neg", FailingReasons.DTYPE_MISMATCH),
        ("pow", FailingReasons.DATA_MISMATCH_ALL_CLOSE),
        ("pow", FailingReasons.DATA_MISMATCH_AUTOMATIC),
        ("pow", FailingReasons.UNSUPPORTED_EXPONENT_VALUE),
        ("pow", FailingReasons.VERIFICATION_FAILED_PCC_NAN),
        ("pow", FailingReasons.VERIFICATION_FAILED_SPECIAL_VALUES),
        ("reciprocal", FailingReasons.DATA_MISMATCH_ALL_CLOSE),
        ("reciprocal", FailingReasons.DATA_MISMATCH_AUTOMATIC),
        ("reciprocal", FailingReasons.VERIFICATION_FAILED_SPECIAL_VALUES),
        ("remainder", FailingReasons.DATA_MISMATCH_ALL_CLOSE),
        ("remainder", FailingReasons.DATA_MISMATCH_PCC_LOW_RANGE),
        ("remainder", FailingReasons.VERIFICATION_FAILED_SPECIAL_VALUES),
        ("repeat_interleave", FailingReasons.DATA_MISMATCH_ALL_CLOSE),
        ("repeat_interleave", FailingReasons.NORMALIZED_INDEX_OUT_OF_BOUNDS),
        ("repeat_interleave", FailingReasons.VERIFICATION_FAILED_PCC_NAN),
        ("reshape", FailingReasons.TENSOR_TRANSFORM_SHAPE_CHECK),
        ("rsqrt", FailingReasons.DATA_MISMATCH_AUTOMATIC),
        ("rsqrt", FailingReasons.VERIFICATION_FAILED_SPECIAL_VALUES),
        ("sin", FailingReasons.DATA_MISMATCH_AUTOMATIC),
        ("softmax", FailingReasons.DATA_MISMATCH_ALL_CLOSE),
        ("softmax", FailingReasons.UNSUPPORTED_AXIS),
        ("softmax", FailingReasons.VERIFICATION_FAILED_PCC_NAN),
        ("sqrt", FailingReasons.VERIFICATION_FAILED_SPECIAL_VALUES),
        ("square", FailingReasons.ATTRIBUTE_ERROR),
        ("squeeze", FailingReasons.CANNOT_SQUEEZE_AXIS_NOT_ONE),
        ("squeeze", FailingReasons.FAILED_MLIR_VERIFICATION),
        ("sub", FailingReasons.DATA_MISMATCH_PCC_LOW_RANGE),
        ("sub", FailingReasons.DTYPE_MISMATCH),
        ("sum", FailingReasons.DATA_MISMATCH_ALL_CLOSE),
        ("sum", FailingReasons.FAILED_MLIR_VERIFICATION),
        ("tanh", FailingReasons.DATA_MISMATCH_ALL_CLOSE),
    ]

    # List of skip reasons for each operator
    # Format: (operator, skip_reason, failing_reason)
    skip = [
        ("matmul", FailingReasons.HIGH_MEMORY, None),
        ("conv2d", FailingReasons.FATAL_ERROR, None),
        ("conv_transpose_2d", FailingReasons.FATAL_ERROR, FailingReasons.ASSERT_STRIDE),
        ("conv_transpose_2d", FailingReasons.FATAL_ERROR, FailingReasons.UNSUPPORTED_DATA_FORMAT),
        ("embedding", FailingReasons.FATAL_ERROR, None),
        ("layer_norm", FailingReasons.FATAL_ERROR, None),
        ("linear", FailingReasons.FATAL_ERROR, None),
        ("pow", FailingReasons.FATAL_ERROR, None),
        ("square", FailingReasons.FATAL_ERROR, None),
        ("avg_pool_2d", FailingReasons.INFERENCE_FROZE, None),
    ]
